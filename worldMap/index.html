<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/stylesheet.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <title>WorldMap</title>
  </head>
  <body id="body">
    <header class="header__nav geography" id="header_nav">
      <div class="header__top_line__background">
        <div class="header__top_line">
          <div class="header__logo">
            <img src="" alt="Логотип" />
          </div>
          <div class="header__list_container">
            <ul class="list">
              <li class="list__points">
                <a class="list__link active" href="#" data-type="geography"
                  >Географія</a
                >
              </li>
              <li class="list__points">
                <a class="list__link" href="#" data-type="history">Історія</a>
              </li>
              <li class="list__points">
                <a class="list__link" href="#" data-type="studies">Навчання</a>
              </li>
              <li class="list__points withoutP" id="listPointWithLanguages">
                <!-- <div class="language__block">
                  <a class="language__selected" id="language__selected">
                    <img
                      src="https://upload.wikimedia.org/wikipedia/en/thumb/f/f3/Flag_of_Russia.svg/188px-Flag_of_Russia.svg.png"
                    />
                    <span>ru</span>
                    <p class="language__arrow">&#709;</p>
                  </a>
                  <div class="language__set">
                    <a class="language">
                      <img
                        src="https://upload.wikimedia.org/wikipedia/en/thumb/f/f3/Flag_of_Russia.svg/188px-Flag_of_Russia.svg.png"
                      />
                      <span>ru</span>
                    </a>
                    <a class="language">
                      <img
                        src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/49/Flag_of_Ukraine.svg/188px-Flag_of_Ukraine.svg.png"
                      />
                      <span>ua</span>
                    </a>
                  </div>
                </div> -->
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="header__content">
        <div class="wrapper">
          <span class="header__main_text">
            Вивчай
            <p>Географ<img src="img/geometka.svg" alt="" />ю</p>
            разом з нами
          </span>
          <p class="header__text">
            натискай на країну та вивчай її політичну, фізичну, топографічну та
            кліматичну карти
          </p>
          <a class="header__button" href="#cellsAndMap">
            Перейти до вивчення
          </a>
        </div>
      </div>
      <div class="header__pictures">
        <div class="wrapper">
          <img
            class="header__earth"
            src="img/one_fourth_earth.png"
            alt="Земля"
          />
          <img src="img/человек.svg" alt="Человек" class="header__person" />
        </div>
      </div>
    </header>

    <div class="map">
      <div class="world_map geography" id="world_map">
        @@include('_cells+svg.html')
      </div>
    </div>

    <div class="tooltip" id="tooltip">
      <span data-stage="1" class="tooltip__country"></span>
      <span data-stage="1" class="tooltip__capital"></span>
    </div>
    <div class="tooltip2">
      <img src="" alt="" class="tooltip2__image" id="tooltip2__image" />
      <p class="tooltip2__name" id="tooltip2__name"></p>
      <ul class="tooltip2__list" id="tooltip2__list">
        <!-- <li class="tooltip2__point"></li> -->
      </ul>
    </div>

    <div class="score" id="score" style="display: none">
      <div class="score__container">
        <div class="score__reset" onclick="scoreReset();"><span>0</span></div>
        <div class="score__block">
          <div class="score__add" onclick="scoreAdd();"><span></span></div>
          <div class="score__numberPlus" id="score__numberPlus">0</div>
          <div class="score__numberMinus" id="score__numberMinus">0</div>
          <div class="score__remove" onclick="scoreRemove();">
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <div class="popup-main" id="popup-main-p1">
      <div class="popup-container" id="popup-container1">
        <div class="popup__top_line">
          <h2 class="popup__title" id="popup__title"></h2>
          <div class="popup__close-icon"></div>
        </div>
        <div class="popup__content">
          <div class="popup__left_column" id="popupLeftColumn">
            <svg
              viewBox=""
              id="mapInPopupWithRegions"
              data-type="general"
              class="popup__svg active"
            >
              <path d="" class="popup__svg__path" />
              @@include('_popup__regions.html')
            </svg>
            <svg
              viewBox=""
              id="mapInPopupWithMountains"
              data-type="mountains"
              class="popup__svg"
            >
              <path d="" class="popup__svg__path" />
              @@include('_popup__mountains.html')
            </svg>
            <svg
              viewBox=""
              id="mapInPopupWithRivers"
              data-type="rivers"
              class="popup__svg"
            >
              <path d="" class="popup__svg__path" />
              @@include('_popup__rivers.html')
            </svg>
          </div>
          <div class="popup__right_column">
            <div class="popup__information active" data-type="general">
              Lorem1000
            </div>
            <div class="popup__information" data-type="mountains"></div>
            <div class="popup__information" data-type="rivers"></div>
          </div>
        </div>
        <div class="popup__footer">
          <div class="popup__points">
            <div class="popup__point active" data-type="general">
              Общая хакартеристика
            </div>
            <div class="popup__point" data-type="mountains">Горы</div>
            <div class="popup__point" data-type="rivers">Реки</div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script
    src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
    crossorigin="anonymous"
  ></script>
  <script src="js/main.js"></script>
  <script type="module">
    // ------------------------------------------------ START CONNECT FIREBASE DATABASE ----------------------------------

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import {
      getDatabase,
      ref,
      set,
      get,
      child,
      update,
      remove,
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCd1ey19rgxuiGoe3s1fgwAXBor2u6ZQ6c",
      authDomain: "worldmap-51cd6.firebaseapp.com",
      databaseURL: "https://worldmap-51cd6-default-rtdb.firebaseio.com",
      projectId: "worldmap-51cd6",
      storageBucket: "worldmap-51cd6.appspot.com",
      messagingSenderId: "664182946054",
      appId: "1:664182946054:web:3b8d35159dc28c2a3c0687",
      measurementId: "G-H7YYLT7DW9",
    };
    const app = initializeApp(firebaseConfig);
    const database = getDatabase();
    const databaseRef = ref(database);

    // ------------------------------------------------ END CONNECT FIREBASE DATABASE ----------------------------------

    // ------------------------------------------------ START GENERAL INFORMATION ----------------------------------

    if (localStorage.getItem("languageId")) {
      var chooseLanguageId = localStorage.getItem("languageId");
      var chooseLanguageCode = localStorage.getItem("languageCode");
      //console.log(chooseLanguage);
    } else {
      var chooseLanguageId = 1;
      var chooseLanguageCode = "ua";
    }

    body.dataset.language = chooseLanguageCode;
    body.className = chooseLanguageCode;

    const countries = document.querySelectorAll(".country");
    const points = document.querySelectorAll(".popup__point");
    const informations = document.querySelectorAll(".popup__information");
    const maps = document.querySelectorAll(".popup__svg");
    const mountains = document.querySelectorAll(".popup__svg__mountain");
    const rivers = document.querySelectorAll(".popup__svg__river");
    const tooltip = document.querySelector(".tooltip");
    const tooltip2 = document.querySelector(".tooltip2");
    const settingsPoints = document.querySelectorAll(".settings__point");

    // ------------------------------------------------ END GENERAL INFORMATION ----------------------------------

    // ------------------------------------------------ START DOWNLOAD COUNTRY NAMES FOR TOOLTIP ---------------------------

    function getBodyScrollTop() {
      return (
        self.pageYOffset ||
        (document.documentElement && document.documentElement.scrollTop) ||
        (document.body && document.body.scrollTop)
      );
    }

    var refToCountryNames = chooseLanguageCode + "/CountryNames";
    get(child(databaseRef, refToCountryNames))
      .then((snapshot) => {
        var sum_countries = countries.length;
        console.log(sum_countries);
        for (var i = 0; i < sum_countries; i++) {
          // console.log("waddawd");
          var temp_id = countries[i].dataset.idofthecountry;
          countries[i].dataset.title = snapshot.val()[temp_id];
          countries[i].setAttribute("name", snapshot.val()[temp_id]);
        }
      })
      .catch((error) => {
        alert(
          "Something was wrong with downloading country names. Please, reload the page (F5)"
        );
      });

    var refToCapitalsOfTheCountries =
      chooseLanguageCode + "/CapitalsOfTheCountries";
    get(child(databaseRef, refToCapitalsOfTheCountries))
      .then((snapshot) => {
        var sum_countries = countries.length;
        for (var i = 0; i < sum_countries; i++) {
          var temp_id = countries[i].dataset.idofthecountry;
          //  console.log("countries[i].dataset.capital");
          countries[i].dataset.capital = snapshot.val()[temp_id];
          //  console.log(snapshot.val()[temp_id]);
        }
      })
      .catch((error) => {
        alert(
          "Something was wrong with downloading capital names. Please, reload the page (F5)"
        );
      });

    // ------------------------------------------------ END DOWNLOAD COUNTRY NAMES FOR TOOLTIP ----------------------------------

    // ------------------------------------------------ START FADE IN POPUP -------------------------------------------------

    function fadeInPopUp(country) {
      var nameCountry = country.dataset.title;
      popup__title.innerText = nameCountry;

      document
        .getElementById("popup-main-p1")
        .setAttribute("style", "display:block");
      document.getElementById("body").classList = "popup_active";
    }

    // ------------------------------------------------ END FADE IN POPUP -------------------------------------------------

    // ------------------------------------------------ START FADE OUT POPUP -------------------------------------------------

    document.addEventListener("mouseup", function (e) {
      var popup = $(".popup-container");
      var popupclose = $(".popup__close-icon");
      if (
        (e.target != popup[0] && popup.has(e.target).length === 0,
        e.target.classList == "popup__close-icon")
      ) {
        document.getElementById("popup-main-p1").removeAttribute("style");
        document.getElementById("body").classList = "";
      }
      if (e.target.classList == "popup__close-icon") {
        document.getElementById("popup-main-p1").removeAttribute("style");
        document.getElementById("body").classList = "";
      }
    });

    // ------------------------------------------------ END FADE OUT POPUP -------------------------------------------------

    // -------------------------------------- START DOWNLOAD AND SHOW COUNTRY INFORMATION ----------------------------------

    var infoAboutTheCountry = "";

    function informationAboutTheCountryAndOpenPopup(idOfTheCountry, x) {
      // ВОЗМНОЖНО ЗАМЕНИТЬ НА АСИНХРОН(ПРОМИЗ)
      get(
        child(databaseRef, "ru/InformationAboutEveryCountry/" + idOfTheCountry)
      )
        .then((snapshot) => {
          infoAboutTheCountry = snapshot.val();
          document.querySelectorAll(".popup__svg").forEach((map) => {
            map.setAttribute("viewBox", infoAboutTheCountry.Map.viewBox);
          });

          document.querySelectorAll(".popup__svg__path").forEach((path) => {
            path.setAttribute("d", infoAboutTheCountry.Map.d);
          });
          console.log(infoAboutTheCountry);
          var i = 0;

          infoAboutTheCountry.Mountains.forEach((mountain) => {
            document
              .querySelectorAll(".popup__svg__mountain")
              [i].setAttribute("d", mountain.position);
            i++;
          });
          i = 0;

          infoAboutTheCountry.Rivers.forEach((river) => {
            document
              .querySelectorAll(".popup__svg__river")
              [i].setAttribute("d", river.position);
            i++;
          });
        })
        .then(fadeInPopUp(x)) // Появление Popup
        .catch((error) => {
          alert("Something was wrong2");
        });
    }
    var lastId = "";
    mountains.forEach((mountain) => {
      mountain.addEventListener("mouseenter", function () {
        tooltip2.style.display = "block";
        var tempIdOfTheMountain = mountain.dataset.idofthemountain;
        var tempMountain = infoAboutTheCountry.Mountains[tempIdOfTheMountain];

        if (lastId != tempIdOfTheMountain) {
          tooltip2__list.innerHTML = "";
          tooltip2__image.setAttribute("src", tempMountain.photo);
          tooltip2__name.innerText = tempMountain.name;
          var tempHeight = document.createElement("li");
          tempHeight.setAttribute("class", "tooltip2__point");
          tempHeight.innerText = "Высота: " + tempMountain.height;
          tooltip2__list.appendChild(tempHeight);
          lastId = tempIdOfTheMountain;
        }
      });
      mountain.addEventListener("mousemove", function (e) {
        //console.log("waddawd");
        tooltip2.style.top = getBodyScrollTop() + 15 + e.y + "px";
        tooltip2.style.left = 15 + e.x + "px";
      });
      mountain.addEventListener("mouseleave", function () {
        tooltip2.style.display = "none";
      });
    });

    lastId = "";
    rivers.forEach((river) => {
      river.addEventListener("mouseenter", function () {
        tooltip2.style.display = "block";
        console.log(river.dataset.idoftheriver);
        var tempIdOfTheRiver = river.dataset.idoftheriver;
        var tempRiver = infoAboutTheCountry.Rivers[tempIdOfTheRiver];

        if (lastId != tempIdOfTheRiver) {
          tooltip2__list.innerHTML = "";
          tooltip2__image.setAttribute("src", tempRiver.photo);
          tooltip2__name.innerText = tempRiver.name;
          var tempLong = document.createElement("li");
          tempLong.setAttribute("class", "tooltip2__point");
          tempLong.innerText = "Длина: " + tempRiver.long;
          tooltip2__list.appendChild(tempLong);
          var tempSquare = document.createElement("li");
          tempSquare.setAttribute("class", "tooltip2__point");
          tempSquare.innerText = "Площадь бассейна: " + tempRiver.square;
          tooltip2__list.appendChild(tempSquare);
          var tempDelta = document.createElement("li");
          tempDelta.setAttribute("class", "tooltip2__point");
          tempDelta.innerText = "Дельта: " + tempRiver.delta;
          tooltip2__list.appendChild(tempDelta);
          lastId = tempIdOfTheRiver;
        }
      });
      river.addEventListener("mousemove", function (e) {
        tooltip2.style.top = getBodyScrollTop() + 15 + e.y + "px";
        tooltip2.style.left = 15 + e.x + "px";
      });
      river.addEventListener("mouseleave", function () {
        tooltip2.style.display = "none";
      });
    });

    // --------------------------------------- END DOWNLOAD AND SHOW COUNTRY INFORMATION ----------------------------------

    // ---------------------------------------------- START EVENTLISTENERS ON COUNTRIES ----------------------------------

    countries.forEach((country) => {
      country.addEventListener("click", function () {
        var idOfTheCntr = this.dataset.idofthecountry;
        //informationAboutTheCountryAndOpenPopup(idOfTheCntr, this);
      });
      country.addEventListener("mouseenter", function () {
        document.getElementsByName(this.dataset.title).forEach((e) => {
          if (e.classList == "country t20") {
            e.setAttribute("class", "country t20 hover");
          }
          if (e.classList == "country") {
            e.setAttribute("class", "country hover");
          }
        });
        tooltip.getElementsByClassName("tooltip__country")[0].innerText =
          this.dataset.title;
        tooltip.getElementsByClassName("tooltip__capital")[0].innerText =
          this.dataset.capital;
        tooltip.getElementsByClassName("tooltip__capital")[0].style.display =
          "block";
        tooltip.getElementsByClassName("tooltip__country")[0].style.display =
          "block";
        //console.log(tooltip.getElementsByClassName("tooltip__country")[0]);
        if (
          tooltip.getElementsByClassName("tooltip__country")[0].dataset.stage ==
          "0"
        ) {
          tooltip.getElementsByClassName("tooltip__country")[0].style.display =
            "none";
          tooltip.style.display = "none";
        }
        if (
          tooltip.getElementsByClassName("tooltip__capital")[0].dataset.stage ==
          "0"
        ) {
          tooltip.getElementsByClassName("tooltip__capital")[0].style.display =
            "none";
          tooltip.style.display = "none";
        }
        if (
          tooltip.getElementsByClassName("tooltip__country")[0].dataset.stage ==
          "1"
        ) {
          tooltip.getElementsByClassName("tooltip__country")[0].style.display =
            "block";
          tooltip.style.display = "block";
        }
        if (
          tooltip.getElementsByClassName("tooltip__capital")[0].dataset.stage ==
          "1"
        ) {
          tooltip.getElementsByClassName("tooltip__capital")[0].style.display =
            "block";
          tooltip.style.display = "block";
        }
      });
      country.addEventListener("mousemove", function (e) {
        tooltip.style.top = getBodyScrollTop() + 15 + e.y + "px";
        tooltip.style.left = 15 + e.x + "px";
      });
      country.addEventListener("mouseleave", function () {
        tooltip.style.display = "none";
        countries.forEach((e) => {
          if (e.classList == "country t20 hover") {
            e.setAttribute("class", "country t20");
          }
          if (e.classList == "country hover") {
            e.setAttribute("class", "country");
          }
        });
      });
    });

    // ------------------------------------------------ END EVENTLISTENERS ON COUNTRIES ----------------------------------

    // ------------------------------------------------ START EVENTLISTENERS ON POINTS ----------------------------------

    points.forEach((point) => {
      point.addEventListener("click", function () {
        points.forEach((point) => {
          point.classList = "popup__point";
        });
        this.classList = "popup__point active";
        var typeOfThePoint = this.dataset.type;
        if (typeOfThePoint == "mountains") {
          document
            .querySelectorAll(".popup__svg__mountain")
            .forEach((mountain) => {
              mountain.setAttribute("style", "display: block");
            });
        }
        if (typeOfThePoint == "rivers") {
          document.querySelectorAll(".popup__svg__river").forEach((river) => {
            river.setAttribute("style", "display: block");
          });
        }
        informations.forEach((information) => {
          information.classList = "popup__information";
          if (information.dataset.type == typeOfThePoint) {
            information.classList = "popup__information active";
          }
        });
        maps.forEach((map) => {
          map.classList = "popup__svg";
          console.log(typeOfThePoint);
          if (map.dataset.type == typeOfThePoint) {
            map.classList = "popup__svg active";
          }
        });
      });
    });

    // ------------------------------------------------ END EVENTLISTENERS ON POINTS ----------------------------------

    // ------------------------------------------------ START DOWNLOAD LANGUAGE FROM DB -----------------------------------

    get(child(databaseRef, "languages"))
      .then((snapshot) => {
        var snapshotContent = snapshot.val();
        console.log(snapshotContent);
        snapshotContent.forEach((snap) => {
          var tempId = snap.id;
          var tempSrc = snap.flag;
          var tempCode = snap.code;
          var tempBlock1 = document.createElement("a");
          tempBlock1.setAttribute("class", "language");
          tempBlock1.setAttribute("data-idofthelanguage", tempId);
          tempBlock1.addEventListener("click", function () {
            language__selected.getElementsByTagName("img")[0].src =
              this.getElementsByTagName("img")[0].src;
            language__selected.getElementsByTagName("span")[0].innerHTML =
              this.getElementsByTagName("span")[0].innerHTML;
            localStorage.setItem("languageId", this.dataset.idofthelanguage);
            localStorage.setItem("languageCode", tempCode);
            window.location.reload();
          });
          var tempBlock2 = document.createElement("img");
          tempBlock2.setAttribute("src", tempSrc);
          var tempBlock3 = document.createElement("span");
          tempBlock3.innerHTML = tempCode;
          tempBlock1.appendChild(tempBlock2);
          tempBlock1.appendChild(tempBlock3);
          language__set.appendChild(tempBlock1);
          if (snap.id == chooseLanguageId) {
            language__selected.getElementsByTagName("img")[0].src = tempSrc;
            language__selected.getElementsByTagName("span")[0].innerHTML =
              tempCode;
          }
        });
      })
      .catch((error) => {
        alert(
          "Something was wrong with downloading languages. Please, reload the page (F5)"
        );
      });

    // ------------------------------------------------ END DOWNLOAD LANGUAGE FROM DB -----------------------------------

    settingsPoints.forEach((point) => {
      point.addEventListener("click", function () {
        //var temp = this.getElementsByTagName("span")[0];
        if (this.getElementsByTagName("span")[0].className == "") {
          this.getElementsByTagName("span")[0].className = "active";
          if (
            this.getElementsByTagName("span")[0].dataset.idofthesetting == "0"
          ) {
            tooltip.getElementsByClassName(
              "tooltip__country"
            )[0].dataset.stage = "1";
          }
          if (
            this.getElementsByTagName("span")[0].dataset.idofthesetting == "1"
          ) {
            tooltip.getElementsByClassName(
              "tooltip__capital"
            )[0].dataset.stage = "1";
          }
          if (
            this.getElementsByTagName("span")[0].dataset.idofthesetting == "2"
          ) {
            score.setAttribute("style", "display: block;");
          }
        } else if (this.getElementsByTagName("span")[0].className == "active") {
          this.getElementsByTagName("span")[0].className = "";
          if (
            this.getElementsByTagName("span")[0].dataset.idofthesetting == "0"
          ) {
            tooltip.getElementsByClassName(
              "tooltip__country"
            )[0].dataset.stage = "0";
          }
          if (
            this.getElementsByTagName("span")[0].dataset.idofthesetting == "1"
          ) {
            tooltip.getElementsByClassName(
              "tooltip__capital"
            )[0].dataset.stage = "0";
          }
          if (
            this.getElementsByTagName("span")[0].dataset.idofthesetting == "2"
          ) {
            score.setAttribute("style", "display: none;");
          }
        }
      });
      point.firstChild.addEventListener("change", function () {
        console.log("awd");
      });
    });
  </script>
</html>
